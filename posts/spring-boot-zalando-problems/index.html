<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://gagan405.github.io name=base><title>
            
                SpringBoot — Exceptions to Responses
            
        </title><meta content="SpringBoot — Exceptions to Responses" property=og:title><meta content="Making sense of exceptions using Zalando Problems" property=og:description><meta content="Making sense of exceptions using Zalando Problems" name=description><link href=https://gagan405.github.io/icon/favicon.png rel=icon type=image/png><link href=https://gagan405.github.io/fonts.css rel=stylesheet><script defer src=https://gagan405.github.io/js/codeblock.js></script><script defer src=https://gagan405.github.io/js/toc.js></script><script defer src=https://gagan405.github.io/js/note.js></script><script>MathJax = {
                    tex: {
                        inlineMath: [
                            ['$', '$'],
                            ['\\(', '\\)']
                        ]
                    }
                };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="
    gb mishra
" href=https://gagan405.github.io/atom.xml rel=alternate type=application/atom+xml><link title="
    gb mishra
" href=https://gagan405.github.io/rss.xml rel=alternate type=application/rss+xml><link href=https://gagan405.github.io/theme/light.css rel=stylesheet><link href=https://gagan405.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://gagan405.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://gagan405.github.io/main.css media=screen rel=stylesheet><script src="https://gagan405.github.io/search_index.en.js?h=ed7db15dd4fde6e35f9a" defer></script><script src="https://gagan405.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=left-content></div><div class=content><nav><div class=left-nav><a href=https://gagan405.github.io>gb mishra</a><div class=socials><a class=social href=https://x.com/__gbm rel=me> <img alt=twitter src=https://gagan405.github.io/icons/social/twitter.svg> </a><a class=social href=https://github.com/gagan405/ rel=me> <img alt=github src=https://gagan405.github.io/icons/social/github.svg> </a><a class=social href=/atom.xml rel=me> <img alt=rss src=https://gagan405.github.io/icons/social/rss.svg> </a></div></div><div class=right-nav><a href=https://gagan405.github.io/posts style=margin-right:.5em>/posts</a><a href=https://gagan405.github.io/tags style=margin-right:.5em>/tags</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://gagan405.github.io/icons/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://gagan405.github.io/icons/sun.svg> <img alt=Dark id=moon-icon src=https://gagan405.github.io/icons/moon.svg style=filter:invert()> <img alt=Auto id=auto-icon src=https://gagan405.github.io/icons/auto.svg style=filter:invert()> </a><script>updateItemToggleTheme()</script></div></nav><div data-selector="main article p" class=visible-element-observer-root><main><article><div class=title><div class=page-header>SpringBoot — Exceptions to Responses</div><div class=meta>Posted on <time>2017-04-16</time><span class=tags-label>::</span><span class=tags> <a class=post-tag href=https://gagan405.github.io/tags/java/>java</a> <a class=post-tag href=https://gagan405.github.io/tags/microservices/>microservices</a> <a class=post-tag href=https://gagan405.github.io/tags/spring-boot/>spring-boot</a> <a class=post-tag href=https://gagan405.github.io/tags/error-handling/>error-handling</a> </span></div></div><section class=body><p>As applications grow, number of APIs increase, number of consumers increase, it is extremely critical to have a uniform response structure across all APIs. Different APIs behaving differently, conflicting error codes or a <code>HttpStatus</code> of 500 for something like a invalid credit card number or email in the request payload is highly undesirable.<p>The standard way of responding error/exceptional situations is well documented in Spring. This roughly can be done like :<ul><li>In your resource method, return a <code>ResponseEntity</code>, with the desired Object body. This will look something like this :</ul><pre class=language-java data-lang=java style=color:#c0c5ce;background-color:#2b303b><code class=language-java data-lang=java><span style=color:#b48ead>return </span><span style=color:#ebcb8b>ResponseEntity</span><span>.</span><span style=color:#bf616a>status</span><span>(</span><span style=color:#d08770>401</span><span>).</span><span style=color:#bf616a>body</span><span>("</span><span style=color:#a3be8c>{</span><span style=color:#96b5b4>\"</span><span style=color:#a3be8c>message</span><span style=color:#96b5b4>\"</span><span style=color:#a3be8c> : </span><span style=color:#96b5b4>\"</span><span style=color:#a3be8c>Invalid password</span><span style=color:#96b5b4>\"</span><span style=color:#a3be8c>}</span><span>");
</span></code></pre><ul><li>Or the other way could be, and more preferable way, is to throw Exceptions and write Exception mappers which then convert the exceptions to appropriate response objects. Google for it and numerous examples are available on this.</ul><p>Quite some time ago, I found this <a href=https://github.com/zalando/problem>Zalando Problems</a> library, that takes the second approach, and generates nice reponse structures for various exception types, and is easy integrated with <a href=https://github.com/zalando/problem-spring-web>Spring Boot</a>.<p>Their package, by default handles quite a number of exception types. But, as the need to have custom exception types come, we have to provide <code>AdviceTrait</code>s for the new exception types. Which is done like something as below :<p>A custom exception class :<pre class=language-java data-lang=java style=color:#c0c5ce;background-color:#2b303b><code class=language-java data-lang=java><span style=color:#b48ead>public class </span><span style=color:#ebcb8b>InvalidEmailException </span><span style=color:#b48ead>extends </span><span style=color:#a3be8c>RuntimeException </span><span style=color:#eff1f5>{
</span><span style=color:#eff1f5>  </span><span style=color:#b48ead>public </span><span style=color:#8fa1b3>InvalidEmailException</span><span style=color:#eff1f5>(</span><span style=color:#ebcb8b>String </span><span style=color:#bf616a>msg</span><span style=color:#eff1f5>){
</span><span style=color:#eff1f5>    </span><span style=color:#bf616a>super</span><span style=color:#eff1f5>(msg);
</span><span style=color:#eff1f5>  }
</span><span style=color:#eff1f5>}
</span></code></pre><p>An advice trait that converts it to a response object:<pre class=language-java data-lang=java style=color:#c0c5ce;background-color:#2b303b><code class=language-java data-lang=java><span style=color:#b48ead>public interface </span><span style=color:#ebcb8b>InvalidEmailAdviceTrait </span><span style=color:#b48ead>extends </span><span style=color:#a3be8c>AdviceTrait </span><span style=color:#eff1f5>{
</span><span style=color:#eff1f5>
</span><span style=color:#eff1f5>    @</span><span style=color:#bf616a>ExceptionHandler
</span><span style=color:#eff1f5>    </span><span style=color:#b48ead>default </span><span style=color:#ebcb8b>ResponseEntity</span><span style=color:#eff1f5>&lt;</span><span style=color:#ebcb8b>Problem</span><span style=color:#eff1f5>> </span><span style=color:#8fa1b3>handleInvalidEmail</span><span style=color:#eff1f5>(
</span><span style=color:#eff1f5>            </span><span style=color:#b48ead>final </span><span style=color:#ebcb8b>InvalidEmailException </span><span style=color:#bf616a>exception</span><span style=color:#eff1f5>,
</span><span style=color:#eff1f5>            </span><span style=color:#b48ead>final </span><span style=color:#ebcb8b>NativeWebRequest </span><span style=color:#bf616a>request</span><span style=color:#eff1f5>) {
</span><span style=color:#eff1f5>        </span><span style=color:#b48ead>return </span><span style=color:#bf616a>create</span><span style=color:#eff1f5>(</span><span style=color:#ebcb8b>Status</span><span style=color:#eff1f5>.</span><span style=color:#d08770>BAD_REQUEST</span><span style=color:#eff1f5>, exception, request);
</span><span style=color:#eff1f5>    }
</span><span style=color:#eff1f5>}
</span></code></pre><p>Now we plug this in along with the other traits: (<code>ProblemHandling</code> is the packaged interface from zalando library.)<pre class=language-java data-lang=java style=color:#c0c5ce;background-color:#2b303b><code class=language-java data-lang=java><span style=color:#b48ead>public interface </span><span style=color:#ebcb8b>CustomProblemHandling </span><span style=color:#b48ead>extends </span><span style=color:#a3be8c>ProblemHandling</span><span style=color:#eff1f5>, </span><span style=color:#a3be8c>InvalidEmailAdviceTrait</span><span style=color:#eff1f5>{
</span><span style=color:#eff1f5>}
</span></code></pre><p>We need to provide this as a <code>ControllerAdvice</code> so that spring makes use of it.<pre class=language-java data-lang=java style=color:#c0c5ce;background-color:#2b303b><code class=language-java data-lang=java><span>@</span><span style=color:#bf616a>ControllerAdvice
</span><span style=color:#b48ead>public class </span><span style=color:#ebcb8b>CustomExceptionHandler </span><span style=color:#b48ead>implements </span><span style=color:#a3be8c>CustomProblemHandling</span><span style=color:#eff1f5>{
</span><span style=color:#eff1f5>}
</span></code></pre><p>And thats it! You raise a <code>InvalidEmailException</code> and the appropriate response is returned.<pre class=language-java data-lang=java style=color:#c0c5ce;background-color:#2b303b><code class=language-java data-lang=java><span style=color:#b48ead>throw new </span><span style=color:#ebcb8b>InvalidEmailException</span><span>("</span><span style=color:#a3be8c>Invalid email format.</span><span>");
</span></code></pre><p>Response :<pre style=color:#c0c5ce;background-color:#2b303b><code><span>{
</span><span>	"title": "Bad Request",
</span><span>	"status": 400,
</span><span>	"detail": "Invalid email format.."
</span><span>}
</span></code></pre><p>To be noted that the response will have a <code>Content-Type</code> of <a href=https://tools.ietf.org/html/rfc7807><code>application/problem+json</code></a>.</section></article></main></div></div><div class=right-content></div>